<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="personal develop">
<meta property="og:type" content="website">
<meta property="og:title" content="yezi">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="yezi">
<meta property="og:description" content="personal develop">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="yezi">
<meta name="twitter:description" content="personal develop">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>yezi</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?84faf04b055e622097ae9117a8d764c0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">yezi</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-/"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-/archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-/tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/19/H5上传图片/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/19/H5上传图片/" itemprop="url">H5上传图片</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-19T19:37:19+08:00">
                2017-07-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/07/19/H5上传图片/" class="leancloud_visitors" data-flag-title="H5上传图片">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="H5上传头像"><a href="#H5上传头像" class="headerlink" title="H5上传头像"></a>H5上传头像</h1><hr>
<p>大体的思路是，部分API的兼容性请参照caniuse：</p>
<ol>
<li>利用FileReader,读取blob对象,或者是file对象，将图片转化为data uri的形式。</li>
<li>使用canvas,在页面上新建一个画布,利用canvas提供的API,将图片画入这个画布当中。</li>
<li>利用canvas.toDataURL()，进行图片的压缩，得到图片的data uri的值</li>
<li>上传文件</li>
</ol>
<h2 id="HTML部分-（在vue环境下执行）"><a href="#HTML部分-（在vue环境下执行）" class="headerlink" title="HTML部分 （在vue环境下执行）"></a>HTML部分 （在vue环境下执行）</h2><pre><code>&lt;input type=&quot;file&quot; class=&quot;fileInput&quot; ref=&apos;fileInput&apos; accept=&quot;image/*&quot;&gt;
</code></pre><p> accept=”image/*” 表示只接受图片类型的文件</p>
<h2 id="监听input-type-’file’-选择文件"><a href="#监听input-type-’file’-选择文件" class="headerlink" title="监听input[type=’file’]选择文件"></a>监听input[type=’file’]选择文件</h2><pre><code>this.$refs.fileInput.addEventListener(&apos;change&apos;, (event) =&gt; {
    console.log(this.$refs.fileInput.files[0])
    var file = this.$refs.fileInput.files[0]
    // 传入图像文件
    that.upLoadAvatar(file)
  })
</code></pre><h2 id="显示图像函数"><a href="#显示图像函数" class="headerlink" title="显示图像函数"></a>显示图像函数</h2><pre><code>upLoadAvatar (file) {
    var that = this
    var fr = new FileReader()
    fr.readAsDataURL(file)
    fr.onload = function (e) {
      that.$refs.img.setAttribute(&apos;src&apos;, e.target.result)
    }
  }
</code></pre><p>这样就可以在本地调试完毕，图像能够正确选择出来</p>
<hr>
<h2 id="利用canvas压缩图片大小"><a href="#利用canvas压缩图片大小" class="headerlink" title="利用canvas压缩图片大小"></a>利用canvas压缩图片大小</h2><p>增加canvas标签，设置隐藏不可见</p>
<pre><code>&lt;canvas id=&quot;canvas&quot; style=&quot;display:none&quot;&gt;&lt;/canvas&gt;
</code></pre><p>增加压缩函数</p>
<pre><code>compressImg (img) {
    var canvas = document.getElementById(&apos;canvas&apos;)
    var ctx = canvas.getContext(&apos;2d&apos;)
    // 利用canvas进行绘图
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height)
    // 将原来图片的质量压缩到原先的0.2倍。
    var data = canvas.toDataURL(&apos;image/jpeg&apos;, 0.2) // data url的形式
    return data
  }
</code></pre><h4 id="HTMLCanvasElement-toDataURL-方法返回一个包含图片展示的-data-URI-。可以使用-type-参数其类型，默认为-PNG-格式。图片的分辨率为96dpi"><a href="#HTMLCanvasElement-toDataURL-方法返回一个包含图片展示的-data-URI-。可以使用-type-参数其类型，默认为-PNG-格式。图片的分辨率为96dpi" class="headerlink" title="HTMLCanvasElement.toDataURL() 方法返回一个包含图片展示的 data URI 。可以使用 type 参数其类型，默认为 PNG 格式。图片的分辨率为96dpi"></a>HTMLCanvasElement.toDataURL() 方法返回一个包含图片展示的 data URI 。可以使用 type 参数其类型，默认为 PNG 格式。图片的分辨率为96dpi</h4><blockquote>
<p>canvas.toDataURL(type, encoderOptions)</p>
</blockquote>
<p><font color="red">type 可选</font><br>图片格式，默认为 image/png</p>
<p><font color="red">encoderOptions 可选</font><br>在指定图片格式为 image/jpeg 或 image/webp的情况下，可以从 0 到 1 的区间内选择图片的质量。如果超出取值范围，将会使用默认值 0.92。其他参数会被忽略。</p>
<h4 id="回到整题，修改uploadAvatar函数"><a href="#回到整题，修改uploadAvatar函数" class="headerlink" title="回到整题，修改uploadAvatar函数"></a>回到整题，修改uploadAvatar函数</h4><pre><code>upLoadAvatar (file) {
    if (!file) {
      return
    }
    var MAXSIZE = 100 * 1024 // 超过这个值就进行压缩
    var that = this
    var fr = new FileReader()
    fr.onload = function (e) {
      var result = this.result
      var img = new Image()

      // img.onload必须的，不然加载的图片会看不见
      img.onload = function () {
        // 如果大于100K则进行压缩
        if (file.size &gt;= MAXSIZE) {
          var imgData = that.compressImg(img)
          // username用来辨别用户，avatar是上传的图片
          let userInfo = {
            username: that.user.name,
            avatar: imgData
          }
          that.$http.post(&apos;/refreshInfo&apos;, {userInfo}).then((res) =&gt; {
            that.user = res.data
          })
        } else {
            // 不压缩则直接上传
          let userInfo = {
            username: that.user.name,
            avatar: result
          }
          that.$http.post(&apos;/refreshInfo&apos;, {userInfo}).then((res) =&gt; {
            that.user = res.data
          })
        }
      }
      img.src = this.result
    }
    fr.readAsDataURL(file)
  }
</code></pre><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a><font color="red">注意：</font></h4><p>fr.onload = function () {<br>    this.result…   // 这个返回的是base64编码的url，可以直接发送<br>}</p>
<hr>
<h2 id="后台处理，返回修改后的数据"><a href="#后台处理，返回修改后的数据" class="headerlink" title="后台处理，返回修改后的数据"></a>后台处理，返回修改后的数据</h2><p>用node模拟了后台接口，实现对mongoose数据的修改和数据返回</p>
<pre><code>router.post(&apos;/refreshInfo&apos;, (req, res) =&gt; {
    var userInfo = req.body.userInfo
    // 不允许修改密码
    if (userInfo.password) {
        return
    }
    // 修改mongoose的数据
    user.update({username: userInfo.username}, {$set: {avatar: userInfo.avatar}}, function (err, result) {
      if (err) {
        console.log(err)
    } else {
        console.log(&apos;update success&apos;)
        user.find({username: userInfo.username}, (err, data) =&gt; {
            if (err) {
                console.log(err)
            } else {
                if (data.length === 0) {
                   res.send(&apos;fail&apos;)
               } else {
                var user = {
                    name: data[0].username,
                    avatar: data[0].avatar
                }
                res.send(user)
            }
        }
    })
    }
})
})
</code></pre><h3 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a><font color="red">注意：</font></h3><p>每一个接口只能返回一个header，即res.send或者其他的只能执行一次，否则会报错</p>
<blockquote>
<p>Error: Can’t set headers after they are sent</p>
</blockquote>
<p><a href="https://cnodejs.org/topic/53774ffecbcc396349ca1155" target="_blank" rel="external">Can’t set headers after they are sent解决方案</a></p>
<hr>
<h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ol>
<li>通过ajax不能上传超过100K的图片，怎么解决？</li>
<li>没有实现上传失败的处理方案</li>
</ol>
<p>后续慢慢填坑。。。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/10/backdrop-filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/10/backdrop-filter/" itemprop="url">backdrop-filter</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-10T00:22:48+08:00">
                2017-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/07/10/backdrop-filter/" class="leancloud_visitors" data-flag-title="backdrop-filter">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="css新属性backdrop-filter"><a href="#css新属性backdrop-filter" class="headerlink" title="css新属性backdrop-filter"></a>css新属性backdrop-filter</h1><hr>
<p>在iOS系统上常常能看到高斯模糊(Gaussian Blur)效果，而这种效果早期使用CSS来实现是较为痛苦的一件事情。其实，早上2011年，浏览器就开始对CSS filters规范有所支持。也就是说在2011年浏览器就可以实现Filters效果。但这种效果基本上都只运用在SVG上(只有SVG支持Filter效果)，而且只有Firefox浏览器支持，并且只能运用在HTML上。这也造就CSS要实现Filters效果是非常蛋疼的一件事情。比如说下图的效果：</p>
<p><img src="http://wx4.sinaimg.cn/mw1024/a359ab18gy1fhdwokjuh8j20c405xwfk.jpg" alt="fosted-glass"></p>
<h3 id="浏览器兼容性"><a href="#浏览器兼容性" class="headerlink" title="浏览器兼容性"></a>浏览器兼容性</h3><p><img src="http://wx4.sinaimg.cn/mw690/a359ab18gy1fhdwrsqo5lj20pp0863z2.jpg" alt="此处输入图片的描述"></p>
<p>  到目前为止，也仅有Safari 9支持</p>
<h2 id="backdrop-filter"><a href="#backdrop-filter" class="headerlink" title="backdrop-filter"></a>backdrop-filter</h2><p>backdrop-filter是在Filter Level2提出来的。其取值和filter Level1中filter属性的属性值一样，包括：</p>
<ol>
<li>blur()</li>
<li>brightness()</li>
<li>contrast()</li>
<li>drop-shadow()</li>
<li>grayscale()</li>
<li>hue-rotate()</li>
<li>invert()</li>
<li>opacity()</li>
<li>saturate()</li>
<li>sepia()</li>
</ol>
<p>这个属性现在仅仅适用于ios端，用来实现ios端毛玻璃效果</p>
<font color="blue">参考资料(<a href="http://www.w3cplus.com/css3/advanced-css-filters.html" target="_blank" rel="external">http://www.w3cplus.com/css3/advanced-css-filters.html</a>)</font>

<hr>
<h2 id="纯css实现毛玻璃另外一种方法："><a href="#纯css实现毛玻璃另外一种方法：" class="headerlink" title="纯css实现毛玻璃另外一种方法："></a>纯css实现毛玻璃另外一种方法：</h2><p>先搞一个div作为容器层，用来放置风景背景图。内部放一个div，作为毛玻璃的主体。再放一个img，显示图标。<br>容器层：大小是图片大小，把风景图作为背景显示，no-repeat。这里用到一个小技巧，将background-attachment设成fixed，不随元素滚动，让子元素继承了本层的背景后，子元素就变成了一个viewport，移到哪儿就看到背景的哪儿</p>
<pre><code>.container{
    width: 287px;height: 285px;
    background-image: url(background.png);    
    background-repeat: no-repeat;
    background-attachment: fixed;
    overflow: hidden;
}
</code></pre><p>毛玻璃层：这里的关键技巧就是background:inherit，直接使用了父元素的背景，和父级的background-attachment:fixed可完成从相机看世界的各种牛逼效果。本文的的毛玻璃是全景，当然可以上半部或者下半部，或者其他位置，这就看出inherit和fixed牛逼的地方了。        </p>
<pre><code>.frosted-glass{
    width: 287px;
    height: 285px;
    background: inherit;
    -webkit-filter: blur(5px);
    -moz-filter: blur(5px);
    -ms-filter: blur(5px);
    -o-filter: blur(5px);
    filter: blur(5px);
    filter: progid:DXImageTransform.Microsoft.Blur(PixelRadius=4, MakeShadow=false);
}
</code></pre><p>测试了只能对图片进行模糊，对dom节点这些页面展示内容无法进行模糊。</p>
<p>要实现对页面内容模糊，方法是：<br>1、需要能将图片模糊的滤镜。<br>2、需要捕获到毛玻璃浮层下面所有内容的图像信息。就好像截屏。<br>3、需要让图片运动能与浏览器滚动同步。主要难点在于实时同步，尤其是处理滚动的惯性。</p>
<font color="blue">参考资料(<a href="https://www.zhihu.com/question/23533918" target="_blank" rel="external">https://www.zhihu.com/question/23533918</a>)<br>如何通过 HTML5 实现 iOS 7 的实时毛玻璃模糊效果？  —by 知乎</font>



          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/17/node保存登陆信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/17/node保存登陆信息/" itemprop="url">node保存登陆信息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-17T20:18:58+08:00">
                2017-06-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/06/17/node保存登陆信息/" class="leancloud_visitors" data-flag-title="node保存登陆信息">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="node-vue实现记住密码功能"><a href="#node-vue实现记住密码功能" class="headerlink" title="node+vue实现记住密码功能"></a>node+vue实现记住密码功能</h1><hr>
<p>首先要引入依赖</p>
<pre><code>var session = require(&apos;express-session&apos;);
var cookieParser = require(&apos;cookie-parser&apos;);
var MongoStore = require(&apos;connect-mongo&apos;)(session);//用来将session添加到mongodb数据库，实现长时间保存
</code></pre><p>使用session（在build\dev-server.js）</p>
<pre><code>app.use(cookieParser());
   app.use(session({
     secret:&apos;secret&apos;,
     resave:true, // don&apos;t save session if unmodified
     saveUninitialized:false,// don&apos;t create session until something stored
     cookie:{
       maxAge:1000*60*10 //过期时间设置(单位毫秒)
     },
     store: new MongoStore({   //创建新的mongodb数据库
           host: &apos;localhost&apos;,    //数据库的地址，本机的话就是127.0.0.1，也可以是网络主机
           port: 27017,          //数据库的端口号
           db: &apos;test&apos;        //数据库的名称。
         })
   }));
</code></pre><h3 id="这样子的代码有一个报错："><a href="#这样子的代码有一个报错：" class="headerlink" title="这样子的代码有一个报错："></a>这样子的代码有一个报错：</h3><blockquote>
<p>Error: Connection strategy not found MongoDB</p>
</blockquote>
<p>解决方法是store里面要有url，不知道是不是版本问题：</p>
<pre><code>store: new MongoStore({   //创建新的mongodb数据库
    url: &apos;mongodb://localhost/test&apos; 
  })
</code></pre><h3 id="再次有一个报错："><a href="#再次有一个报错：" class="headerlink" title="再次有一个报错："></a>再次有一个报错：</h3><blockquote>
<p> Cannot set property ‘user’ of undefined</p>
</blockquote>
<p>百度了一下原因是要把sesson的配置放在路由之前。</p>
<pre><code>app.use(cookieParser());
app.use(session({
  ~
}));
app.use(api) //使用路由
</code></pre><h3 id="增加一个路由，用来返回session的值"><a href="#增加一个路由，用来返回session的值" class="headerlink" title="增加一个路由，用来返回session的值"></a>增加一个路由，用来返回session的值</h3><pre><code>router.get(&apos;/auth&apos;,(req,res) =&gt; {
    if(req.session.user){
        res.send(req.session.user)
    }
});
</code></pre><h4 id="在index主页下增加方法，用来获取用户信息"><a href="#在index主页下增加方法，用来获取用户信息" class="headerlink" title="在index主页下增加方法，用来获取用户信息"></a>在index主页下增加方法，用来获取用户信息</h4><pre><code>/*************************************************
获取登录信息
@ 允许自动登录则返回登陆状态码 1
@ 不允许则返回登陆状态码 2
**************************************************/
router.get(&apos;/auth&apos;,(req,res) =&gt; {
    let token = {
        account: req.session.user,
        loginCode:req.session.loginCode
}
if(token){
    res.send(token)
}
});
</code></pre><h4 id="添加自动登录的函数"><a href="#添加自动登录的函数" class="headerlink" title="添加自动登录的函数"></a>添加自动登录的函数</h4><pre><code>autoLogin(){
    this.$http.get(&apos;/auth&apos;).then((res) =&gt; {
      // console.log(res.data)
      var token = res.data;
      if(token &amp;&amp; token.loginCode === 1){
        this.account = token.account;
        this.isLogin = true;
      }else{
        this.account = token.account;
        this.isLogin = false;
      }
    })
  }
</code></pre><h4 id="在页面创建时候判断是否自动登录"><a href="#在页面创建时候判断是否自动登录" class="headerlink" title="在页面创建时候判断是否自动登录"></a>在页面创建时候判断是否自动登录</h4><pre><code>created(){
  this.autoLogin();
}
</code></pre><p>这样就可以在页面创建时候验证用户信息，实现免登录。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/13/mongodb安装和使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/13/mongodb安装和使用/" itemprop="url">mongodb安装和使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-13T17:22:27+08:00">
                2017-06-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/06/13/mongodb安装和使用/" class="leancloud_visitors" data-flag-title="mongodb安装和使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="mongodb使用"><a href="#mongodb使用" class="headerlink" title="mongodb使用"></a>mongodb使用</h1><hr>
<h2 id="1-安装mongodb（https-www-mongodb-com-download-center-community）"><a href="#1-安装mongodb（https-www-mongodb-com-download-center-community）" class="headerlink" title="1.安装mongodb（https://www.mongodb.com/download-center#community）"></a>1.安装mongodb（<a href="https://www.mongodb.com/download-center#community）" target="_blank" rel="external">https://www.mongodb.com/download-center#community）</a></h2><h2 id="2-配置环境变量，让mongodb可以全局使用"><a href="#2-配置环境变量，让mongodb可以全局使用" class="headerlink" title="2.配置环境变量，让mongodb可以全局使用"></a>2.配置环境变量，让mongodb可以全局使用</h2><p>在【我的电脑】–&gt;属性–&gt;高级设置–&gt;环境变量 path下设置mongodb下bin的路径</p>
<blockquote>
<p>C:\Program Files\MongoDB\Server\3.4\bin</p>
</blockquote>
<p>这样就可以在任意cmd下启动mogodb</p>
<h2 id="3-启动mongodb"><a href="#3-启动mongodb" class="headerlink" title="3.启动mongodb"></a>3.启动mongodb</h2><blockquote>
<p>mongod –dbpath=D:\data\db //dbpath是指定数据存放目录</p>
</blockquote>
<p>成功的话会输出一下内容：<br>2017-04-09T10:45:31.583+0800 I CONTROL  [initandlisten] MongoDB starting : pid=12244 port=27017 dbpath=E:\Tool\modb\db 64-bit host=JSB015<br>2017-04-09T10:45:31.584+0800 I CONTROL  [initandlisten] targetMinOS: Windows Vista/Windows Server 2008<br>…</p>
<h2 id="4-一个简单的mongodb操作实例"><a href="#4-一个简单的mongodb操作实例" class="headerlink" title="4.一个简单的mongodb操作实例"></a>4.一个简单的mongodb操作实例</h2><pre><code> var mongoose = require(&quot;mongoose&quot;);
mongoose.Promise = global.Promise; 
var db = mongoose.connect(&quot;mongodb://127.0.0.1:27017/test&quot;);
var TestSchema = new mongoose.Schema({
    name : {type:String},
    age : {type:Number,default:0},
    email : {type:String},
    time : {type:Date,default:Date.now}
});
var TestModel = db.model(&quot;test1&quot;,TestSchema); 
var TestEntity = new TestModel({
    name:&apos;helloworld&apos;,
    age:28,
    emial:&apos;helloworld@qq.com&apos;
});
TestEntity.save(function(err,doc){
    if(err){
        console.log(&quot;error :&quot; + err);
    } else {
        console.log(doc);
    }
});
</code></pre><p>Schema ： 一种以文件形式存储的数据库模型骨架，不具备数据库的操作能力</p>
<p>Model ： 由Schema发布生成的模型，具有抽象属性和行为的数据库操作对</p>
<p>Entity ： 由Model创建的实体，他的操作也会影响数据库</p>
<h2 id="5-踩坑："><a href="#5-踩坑：" class="headerlink" title="5.踩坑："></a>5.踩坑：</h2><ol>
<li><p> DeprecationWarning: Mongoose: mpromise (mongoose’s default promise library) is deprecated, plug in your own promise library instead: <a href="http://mongoosejs.com/docs/promises.html" target="_blank" rel="external">http://mongoosejs.com/docs/promises.html</a><br>如果出现这段代码，则需要在db.connect之前加入以下代码：</p>
<blockquote>
<p>mongoose.Promise = global.Promise;<br>//或者 这样 ：mongoose.Promise = require(‘bluebird’);</p>
</blockquote>
</li>
<li></li>
</ol>
<pre><code>MongoError: failed to connect to server [127.0.0.1:27017] on first connect
</code></pre><p>这是mongodb数据库没有开启提示的错误，应该先开启数据库连接</p>
<blockquote>
<p>mongod<br>// 或者指定数据目录 mongod –dbpath=d:\data\db</p>
</blockquote>
<h2 id="6-可以让mongodb随window启动而启动"><a href="#6-可以让mongodb随window启动而启动" class="headerlink" title="6.可以让mongodb随window启动而启动"></a>6.可以让mongodb随window启动而启动</h2><p>这样就不用每次都启动一次<br>在命令行执行：</p>
<blockquote>
<p>mongod –logpath D:\MongoDb\logs\MongoDB.log –logappend –dbpath D:\data –directoryperdb –serviceName MongoDB –install –auth</p>
</blockquote>
<p>删除自启动服务：</p>
<blockquote>
<p> sc delete MongoDB</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/11/node上传文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/11/node上传文件/" itemprop="url">node上传文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-11T21:46:52+08:00">
                2017-06-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/06/11/node上传文件/" class="leancloud_visitors" data-flag-title="node上传文件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="node入门——http上传文件服务器"><a href="#node入门——http上传文件服务器" class="headerlink" title="node入门——http上传文件服务器"></a>node入门——http上传文件服务器</h1><hr>
<p>这是第一次学习nodeJS这么语言，参考 Manuel Kiessling 大神的教学文案，结合自己的理解做一个应用允许用户浏览页面以及上传文件，我这里做了一点分析和解答</p>
<p>用到的知识有：</p>
<blockquote>
<ul>
<li>http模块</li>
<li>路由知识</li>
<li>formidable模块</li>
</ul>
</blockquote>
<p>目录结构如下：<br>+node学习<br>    &nbsp; |  –index.js<br>    &nbsp; |  –requestHandles.js<br>    &nbsp; |  –router.js<br>    &nbsp; |  –server.js</p>
<hr>
<h3 id="入口文件提供接口，server用来启动服务器，而路由是用来确定进入的页面，并且传递数据，handles是用来返回数据给客户端。"><a href="#入口文件提供接口，server用来启动服务器，而路由是用来确定进入的页面，并且传递数据，handles是用来返回数据给客户端。" class="headerlink" title="入口文件提供接口，server用来启动服务器，而路由是用来确定进入的页面，并且传递数据，handles是用来返回数据给客户端。"></a>入口文件提供接口，server用来启动服务器，而路由是用来确定进入的页面，并且传递数据，handles是用来返回数据给客户端。</h3><h4 id="入口文件index-js"><a href="#入口文件index-js" class="headerlink" title="入口文件index.js"></a>入口文件index.js</h4><pre><code>var server = require(&quot;./server&quot;);
var router = require(&quot;./router&quot;);
var requestHandlers = require(&quot;./requestHandlers&quot;);

var handle ={}
handle[&quot;/&quot;]= requestHandlers.start;
handle[&quot;/start&quot;]= requestHandlers.start;
handle[&quot;/upload&quot;]= requestHandlers.upload;

server.start(router.route, handle);
</code></pre><h4 id="server-js"><a href="#server-js" class="headerlink" title="server.js"></a>server.js</h4><pre><code>var http = require(&quot;http&quot;);
//url用来解析请求的URL路径
var url = require(&quot;url&quot;);

function start(route, handle){
  function onRequest(request, response){
    var postData =&quot;&quot;; //用来保存上传的数据
    var pathname = url.parse(request.url).pathname; //路径名字
    console.log(&quot;Request for &quot;+ pathname +&quot; received.&quot;);

request.setEncoding(&quot;utf8&quot;);

request.addListener(&quot;data&quot;,function(postDataChunk){
  postData += postDataChunk;
  console.log(&quot;Received POST data chunk &apos;&quot;+
  postDataChunk +&quot;&apos;.&quot;);
});

request.addListener(&quot;end&quot;,function(){
//request请求全部结束后执行，转向对应的路由，执行相应函数
  route(handle, pathname, response, postData);
});

 }
//启动服务
  http.createServer(onRequest).listen(8888);
  console.log(&quot;Server has started.&quot;);
}

exports.start = start;
</code></pre><h4 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a>router.js</h4><pre><code>  function route(handle, pathname, response, postData){
  console.log(&quot;About to route a request for &quot;+ pathname);
  if(typeof handle[pathname]===&apos;function&apos;){
    handle[pathname](response, postData);
  }else{
    console.log(&quot;No request handler found for &quot;+ pathname);
    response.writeHead(404,{&quot;Content-Type&quot;:&quot;text/plain&quot;});
    response.write(&quot;404 Not found&quot;);
    response.end();
  }
}

exports.route = route;
</code></pre><h4 id="requesthandles-js"><a href="#requesthandles-js" class="headerlink" title="requesthandles.js"></a>requesthandles.js</h4><pre><code>var querystring = require(&quot;querystring&quot;);

function start(response, postData){
  console.log(&quot;Request handler &apos;start&apos; was called.&quot;);

  var body =&apos;&lt;html&gt;&apos;+
    &apos;&lt;head&gt;&apos;+
    &apos;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; &apos;+
    &apos;charset=UTF-8&quot; /&gt;&apos;+
    &apos;&lt;/head&gt;&apos;+
    &apos;&lt;body&gt;&apos;+
    &apos;&lt;form action=&quot;/upload&quot; method=&quot;post&quot;&gt;&apos;+
    &apos;&lt;textarea name=&quot;text&quot; rows=&quot;20&quot; cols=&quot;60&quot;&gt;&lt;/textarea&gt;&apos;+
    &apos;&lt;input type=&quot;submit&quot; value=&quot;Submit text&quot; /&gt;&apos;+
    &apos;&lt;/form&gt;&apos;+
    &apos;&lt;/body&gt;&apos;+
    &apos;&lt;/html&gt;&apos;;

    response.writeHead(200,{&quot;Content-Type&quot;:&quot;text/html&quot;});
    response.write(body);
    response.end();
}

function upload(response, postData){
  console.log(&quot;Request handler &apos;upload&apos; was called.&quot;);
  response.writeHead(200,{&quot;Content-Type&quot;:&quot;text/html&quot;});
  //确保中文不会乱码
  response.write(&apos;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;/&gt;&lt;/head&gt;&apos;); 
  response.write(&quot;You&apos;ve sent the text: &quot;+
  querystring.parse(postData).text);
  response.end();
}

exports.start = start;
exports.upload = upload;
</code></pre><font color="red">这样子我们就实现了一个简单的文本输入，显示的小应用，接下来继续完善这个应用</font>

<hr>
<h2 id="处理文件上传"><a href="#处理文件上传" class="headerlink" title="处理文件上传"></a>处理文件上传</h2><p>首先要引入一个模块</p>
<blockquote>
<p>npm install formidable</p>
</blockquote>
<p>官方的使用介绍如下：</p>
<pre><code>    var formidable = require(&apos;formidable&apos;),
    http = require(&apos;http&apos;),
    util = require(&apos;util&apos;);

http.createServer(function(req, res){
  if(req.url ==&apos;/upload&apos;&amp;&amp; req.method.toLowerCase()==&apos;post&apos;){
    // parse a file upload

    //创建Formidable.IncomingForm对象
    var form =new formidable.IncomingForm();
    form.parse(req,function(err, fields, files){
      res.writeHead(200,{&apos;content-type&apos;:&apos;text/plain&apos;});
      res.write(&apos;received upload:\n\n&apos;);
      res.end(util.inspect({fields: fields, files: files}));
    });
    return;
  }

  // show a file upload form
  res.writeHead(200,{&apos;content-type&apos;:&apos;text/html&apos;});
  res.end(
    &apos;&lt;form action=&quot;/upload&quot; enctype=&quot;multipart/form-data&quot; &apos;+
    &apos;method=&quot;post&quot;&gt;&apos;+
    &apos;&lt;input type=&quot;text&quot; name=&quot;title&quot;&gt;&lt;br&gt;&apos;+
    &apos;&lt;input type=&quot;file&quot; name=&quot;upload&quot; multiple=&quot;multiple&quot;&gt;&lt;br&gt;&apos;+
    &apos;&lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;&apos;+
    &apos;&lt;/form&gt;&apos;
  );
}).listen(8888);
</code></pre><h4 id="Q：什么是util"><a href="#Q：什么是util" class="headerlink" title="Q：什么是util"></a>Q：什么是util</h4><blockquote>
<p>util是node.js核心模块，提供常用函数的集合，用于弥补核心js的功能</p>
</blockquote>
<h4 id="Q：util-inspect"><a href="#Q：util-inspect" class="headerlink" title="Q：util.inspect"></a>Q：util.inspect</h4><p>util.inspect(object,[showHidden],[depth],[colors])是一个将任意对象转换为字符串的方法，<br>通常用于调试和错误的输出。</p>
<ol>
<li>showhidden - 是一个可选参数，如果值为true，将会输出更多隐藏信息。</li>
<li>depth - 表示最大递归的层数。如果对象很复杂，可以指定层数控制输出信息的多少。</li>
<li>如果不指定depth,默认会递归3层，指定为null表示不限递归层数完整遍历对象。</li>
<li>如果color = true，输出格式将会以ansi颜色编码，通常用于在终端显示更漂亮的效果。<br><font color="red">注意：</font>特别要指出的是，util.inspect并不会简单地直接把对象转换为字符串，即使对该对象定义了toString方法也不会调用</li>
</ol>
<h4 id="Q：form的enctype-”multipart-form-data”？"><a href="#Q：form的enctype-”multipart-form-data”？" class="headerlink" title="Q：form的enctype=”multipart/form-data”？"></a>Q：form的enctype=”multipart/form-data”？</h4><p>是设置表单的MIME编码。默认情况，这个编码格式是application/x-www-form-urlencoded，不能用于文件上传；只有使用了multipart/form-data，才能完整的传递文件数据</p>
<h3 id="上传代码解析"><a href="#上传代码解析" class="headerlink" title="上传代码解析"></a>上传代码解析</h3><pre><code>    function upload(response, request){
  console.log(&quot;Request handler &apos;upload&apos; was called.&quot;);

  var form =new formidable.IncomingForm();
  console.log(&quot;about to parse&quot;);
  form.uploadDir=&quot;./public&quot;;//必须设置
  form.parse(request,function(error, fields, files){
    console.log(&quot;parsing done&quot;);
    console.log(files);
    fs.renameSync(files.upload.path,&quot;./public/1.jpg&quot;);
    response.writeHead(200,{&quot;Content-Type&quot;:&quot;text/html&quot;});
    response.write(&quot;received image:&lt;br/&gt;&quot;);
    response.write(`&lt;img src=&apos;/show&apos; /&gt;`);
    response.end();
  });
}
</code></pre><p>//设置上传的目录位置</p>
<blockquote>
<p>form.uploadDir=”./public”;</p>
</blockquote>
<p>//更改文件的名字</p>
<blockquote>
<p>fs.renameSync(files.upload.path,”./public/1.jpg”) </p>
</blockquote>
<p>//这段无法显示图片</p>
<blockquote>
<p>response.write(<code>&lt;img src=&#39;./public/1.jpg&#39; /&gt;</code>);</p>
</blockquote>
<p>//如果直接写相对路径或者绝对路径无法显示，原因不明（Q,Q）</p>
<blockquote>
<p>response.write(<code>&lt;img src=&#39;/show&#39; /&gt;</code>);</p>
</blockquote>
<hr>
<p>接下来就按照教程继续下去就行，我就不累赘（<a href="http://ourjs.com/detail/529ca5950cb6498814000005）" target="_blank" rel="external">http://ourjs.com/detail/529ca5950cb6498814000005）</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/08/客户端检测/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/08/客户端检测/" itemprop="url">客户端检测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-08T17:37:44+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/06/08/客户端检测/" class="leancloud_visitors" data-flag-title="客户端检测">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="客户端检测手段"><a href="#客户端检测手段" class="headerlink" title="客户端检测手段"></a>客户端检测手段</h1><hr>
<p>检测手段是通过检测用户代理字符串来判断相应的客户端。</p>
<blockquote>
<ul>
<li>首先检测opera,opera有专属的属性window.opera.version</li>
<li>然后检测webkit内核的浏览器，检测唯一字符串AppleWebKit,如果在这基础上有chrome字符，则是chrome浏览器，否则是safari</li>
<li>接着检测引擎是khtml，即konq浏览器</li>
<li>最后检测ie，唯一字符串是MSIE</li>
</ul>
</blockquote>
<h2 id="chrome代理字符串"><a href="#chrome代理字符串" class="headerlink" title="chrome代理字符串"></a>chrome代理字符串</h2><h4 id="Mozilla-5-0-Windows-NT-10-0-WOW64-AppleWebKit-537-36-KHTML-like-Gecko-Chrome-58-0-3029-110-Safari-537-36"><a href="#Mozilla-5-0-Windows-NT-10-0-WOW64-AppleWebKit-537-36-KHTML-like-Gecko-Chrome-58-0-3029-110-Safari-537-36" class="headerlink" title="Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"></a>Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36</h4><h2 id="firefox代理字符串"><a href="#firefox代理字符串" class="headerlink" title="firefox代理字符串"></a>firefox代理字符串</h2><h4 id="Mozilla-5-0-Windows-NT-10-0-WOW64-rv-53-0-Gecko-20100101-Firefox-53-0"><a href="#Mozilla-5-0-Windows-NT-10-0-WOW64-rv-53-0-Gecko-20100101-Firefox-53-0" class="headerlink" title="Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0"></a>Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0</h4><h2 id="opera代理字符串（最新移除了window-opera属性，所以要对最新的opera要判断字符串OPR）"><a href="#opera代理字符串（最新移除了window-opera属性，所以要对最新的opera要判断字符串OPR）" class="headerlink" title="opera代理字符串（最新移除了window.opera属性，所以要对最新的opera要判断字符串OPR）"></a>opera代理字符串（最新移除了window.opera属性，所以要对最新的opera要判断字符串OPR）</h2><h4 id="Mozilla-5-0-Windows-NT-10-0-WOW64-AppleWebKit-537-36-KHTML-like-Gecko-Chrome-58-0-3029-110-Safari-537-36-OPR-45-0-2552-888"><a href="#Mozilla-5-0-Windows-NT-10-0-WOW64-AppleWebKit-537-36-KHTML-like-Gecko-Chrome-58-0-3029-110-Safari-537-36-OPR-45-0-2552-888" class="headerlink" title="Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 OPR/45.0.2552.888"></a>Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 OPR/45.0.2552.888</h4><h2 id="IE（11版本一下）代理字符串"><a href="#IE（11版本一下）代理字符串" class="headerlink" title="IE（11版本一下）代理字符串"></a>IE（11版本一下）代理字符串</h2><h4 id="Mozilla-5-0-compatible-MSIE-10-0-Windows-NT-6-2-Trident-6-0"><a href="#Mozilla-5-0-compatible-MSIE-10-0-Windows-NT-6-2-Trident-6-0" class="headerlink" title="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)"></a>Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)</h4><h2 id="IE11代理字符串"><a href="#IE11代理字符串" class="headerlink" title="IE11代理字符串"></a>IE11代理字符串</h2><h4 id="Mozilla-5-0-Windows-NT-6-3-Trident-7-0-rv-11-0-like-Gecko"><a href="#Mozilla-5-0-Windows-NT-6-3-Trident-7-0-rv-11-0-like-Gecko" class="headerlink" title="Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko"></a>Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko</h4><h2 id="edge代理字符串"><a href="#edge代理字符串" class="headerlink" title="edge代理字符串"></a>edge代理字符串</h2><h4 id="Mozilla-5-0-Windows-NT-10-0-Win64-x64-AppleWebKit-537-36-KHTML-like-Gecko-Chrome-51-0-2704-79-Safari-537-36-Edge-14-14393"><a href="#Mozilla-5-0-Windows-NT-10-0-Win64-x64-AppleWebKit-537-36-KHTML-like-Gecko-Chrome-51-0-2704-79-Safari-537-36-Edge-14-14393" class="headerlink" title="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36 Edge/14.14393"></a>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36 Edge/14.14393</h4><hr>
<p>代码如下：</p>
<pre><code>&lt;script&gt;
    window.onload = function(){
        var client = (function(){
            var engine = {
            //呈现引擎
            ie:0,
            gecko:0,
            webkit:0,
            khtml:0,
            opera:0,
            ver:null
        }

        var browser = {
            ie:0,
            firefox:0,
            safari:0,
            konq:0,
            opera:0,
            chrome:0,
            ver:null,
            edge:0
        }
        return {
            engine:engine,
            browser:browser
        };
    })()
    var engine = client.engine;
    var browser = client.browser;
    var ua = navigator.userAgent;
    console.log(ua);
    if(window.opera){  /*最新版opera移除了这个属性 Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 OPR/45.0.2552.888*/
        engine.ver = window.opera.version();
        engine.opera = browser.opera = parseFloat(engine.ver)
    }else if(/OPR\/(\S+)/.test(ua)){
        engine.ver = RegExp[&quot;$1&quot;];
        engine.opera = browser.opera = parseFloat(engine.ver)
    }else if(/AppleWebKit\/(\S+)/.test(ua)){
        engine.ver = RegExp[&quot;$1&quot;];
        engine.webkit = parseFloat(engine.ver)
        //确定是chrome还是safari还是edge
        if(/Edge\/(\S+)/.test(ua)){
            browser.ver = RegExp[&quot;$1&quot;];
            browser.edge = parseFloat(browser.ver);
        }else if(/Chrome\/(\S+)/.test(ua)){
            browser.ver = RegExp[&quot;$1&quot;];
            browser.chrome = parseFloat(browser.ver);
        }else if(/Version\/(\S+)/.test(ua)){
            browser.ver = RegExp[&quot;$1&quot;];
            browser.safari = parseFloat(browser.ver);
        }else{
            var safariVersion = 1;
            if(engine.webkit&lt;100){
                safariVersion = 1;
            }else if(engine.webkit&lt;312){
                safariVersion = 1.2;
            }else if(engine.webkit&lt;412){
                safariVersion = 1.3;
            }else {
                safariVersion = 2;
            }

            browser.safari = browser.ver = safariVersion;
        }
    }else if(/KHTML\/(\S+)/.test(ua)||/Konqueror\/([^;]+)/.test(ua)){
        engine.ver = RegExp[&quot;$1&quot;];
        engine.khlmt =  browser.konq = parseFloat(engine.ver)
    }else if(/rv:([^\)]+)\) Gecko\/\d{8}/.test(ua)){
engine.ver = RegExp[&quot;$1&quot;];
engine.gecko = parseFloat(engine.ver)
        //确定是不是firefox
        if(/Firefox\/(\S+)/.test(ua)){
            browser.ver = RegExp[&quot;$1&quot;];
            browser.firefox = parseFloat(browser.ver);
        }
    }else if(/MSIE ([^;]+)/.test(ua)){
        engine.ver = RegExp[&quot;$1&quot;];
        engine.ie =  browser.ie  = parseFloat(engine.ver)
    }else if(/Trident\/([^;]+)/.test(ua)){
        engine.ver = 11.0;
        engine.ie =  browser.ie  = parseFloat(engine.ver)
    }
    console.log(engine);
    console.log(browser)
}
&lt;/script&gt;
</code></pre><hr>
<p>上面是我个人测试常用电脑浏览器的手段，如果要更加详细的检查手段，可以查阅下面的网址<br>github上的客户端检查测代码（<a href="https://github.com/hotoo/detector）" target="_blank" rel="external">https://github.com/hotoo/detector）</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/02/搭建vue音乐播放器（2）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/02/搭建vue音乐播放器（2）/" itemprop="url">搭建vue音乐播放器（2）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-02T17:34:44+08:00">
                2017-06-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/06/02/搭建vue音乐播放器（2）/" class="leancloud_visitors" data-flag-title="搭建vue音乐播放器（2）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="搭建vue音乐播放器（2）"><a href="#搭建vue音乐播放器（2）" class="headerlink" title="搭建vue音乐播放器（2）"></a>搭建vue音乐播放器（2）</h1><hr>
<p>最近在写这个SPA，在做完的时候才有时间认真回顾一下过程，同时写下每个模板结构和我写代码时候发现的一些bug<br>附上项目地址（<a href="https://github.com/yezi12138/vuemusic）" target="_blank" rel="external">https://github.com/yezi12138/vuemusic）</a></p>
<h2 id="第一个说说搜索页面有一个小小bug的修复，代码如下"><a href="#第一个说说搜索页面有一个小小bug的修复，代码如下" class="headerlink" title="第一个说说搜索页面有一个小小bug的修复，代码如下"></a>第一个说说搜索页面有一个小小bug的修复，代码如下</h2><pre><code>//search.vue下的search方法
search(value){  //点击查找
        /*在搜索空字符的时候，会把空字符添加到搜索历史这里，所以 这里我用一个判断return掉空字符*/
            value = value?value:this.searchValue;
            if(value === &apos;&apos;) return;
</code></pre><h2 id="第二个说说我的song-vue模块的设置"><a href="#第二个说说我的song-vue模块的设置" class="headerlink" title="第二个说说我的song.vue模块的设置"></a>第二个说说我的song.vue模块的设置</h2><p>第一次我是song.vue通过路由方式导入，可这样就出现一个问题，首先是动画太僵硬了，第二个是因为有多处可以直接切换到song模块（比如底部模块和主页右上角图标和搜索模块），对于每一个切换的模块来说，需要传入歌曲参数，增加了每个模块之间的耦合度，对于song模块来说，每次都要重新渲染数据，加载数据，网络不好的时候用户体验不好。<br>第二次思考将song隐藏起来，通过store.js来给数据更新，这样大大减低的各个模块的耦合度，而这次我将song里面的播放列表童颜隐藏起来。首先我用的是better-scroll，这个组件需要在dom都渲染完毕才可以拉动。因为我将播放列表先隐藏后展示，这样BScroll无法在显示的时候获取到dom，只能在下一次刷新dom时候才可以拉动播放列表。<br>对于上两次的bug，最终我将song隐藏起来，将songlist移出手机界面达到伪隐藏效果。song的动画和songlist刷新都可以了。</p>
<pre><code>&lt;div id=&quot;app&quot;&gt;
    &lt;router-view&gt;&lt;/router-view&gt;
    &lt;transition name=&quot;slide&quot;&gt;
        &lt;song v-show=&quot;songShow&quot; ref=&quot;song&quot;&gt;&lt;/song&gt;
    &lt;/transition&gt;
    &lt;songlist ref=&quot;songlist&quot;&gt;&lt;/songlist&gt;
    &lt;transition name=&quot;fade&quot;&gt;
        &lt;div class=&quot;bg-wrap&quot; @click=&quot;toggleWrapShow&quot; v-show=&quot;wrapShow&quot;&gt;&lt;/div&gt;
    &lt;/transition&gt;
&lt;/div&gt;
</code></pre><h2 id="对于歌曲的滚动"><a href="#对于歌曲的滚动" class="headerlink" title="对于歌曲的滚动"></a>对于歌曲的滚动</h2><p>首先是需要给li设置高度，否则很难移动对应的距离（当然可以统计前几个移动li的高度再给ul设置，不过这样会增加代码，我反而觉得限定高度比较好）</p>
<pre><code>refleshLyric(){
            var audio = this.$refs.audio;
            var that = this;
            audio.addEventListener(&apos;timeupdate&apos;, function(){
                var ul = document.getElementById(&apos;lrc&apos;),
                lis = ul.querySelectorAll(&apos;li&apos;),
                lyric = that.lyric;
                for(let i =0;i&lt;lyric.length;i++){
                    var j = i+1;
        //这个是用来判断正要高亮的歌词
        if(lyric[i].time&lt;audio.currentTime&amp;&amp;lyric[j].time&gt;audio.currentTime&amp;&amp;i&gt;4){
                        var height = Math.floor(lis[i].offsetHeight);
                        //（i-4）是为了让高亮歌曲在中间
                        ul.style.top = `-${(i-4)*height}px`;
                        lis[i].className = &apos;active&apos;;
                        return;    
                    }else{
                        //将高亮歌词前面的li样式重置
                        lis[i].className = &apos;&apos;;
                    }
                }
            });
        }
</code></pre><p>如果你拖动进度条改变歌曲的进度，则需要下面代码清楚所有的li样式，否则会出现多处高亮的情况</p>
<pre><code>clearLyricCss(){
            var ul = document.getElementById(&apos;lrc&apos;),
            lis = ul.querySelectorAll(&apos;li&apos;);
            lis.forEach((item) =&gt; {
                item.className = &apos;&apos;
            })
        }

//监听进度条移动时候清楚样式    
indicator.addEventListener(&apos;touchmove&apos;, (event) =&gt; {
                this.doOnTouchMove(event);
                this.clearLyricCss();
            });
</code></pre><h2 id="最后讲一下一个小bug"><a href="#最后讲一下一个小bug" class="headerlink" title="最后讲一下一个小bug"></a>最后讲一下一个小bug</h2><p>每次切换新歌曲的时候，如果你之前正在播放音乐，那么播放按钮会显示正在播放的图标，解决方法是每次切换歌曲判断新的歌曲是不是和旧的歌曲一样</p>
<pre><code>//判断进入的是否是正在播放的歌曲，如果不是则重置播放按钮样式
            var currentSong = this.$store.state.currentSong.data;
            if(currentSong.songid != songid){
                this.$store.commit(&apos;initPlaying&apos;)
            }
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/24/归并排序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/24/归并排序/" itemprop="url">归并排序</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-24T09:21:54+08:00">
                2017-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/05/24/归并排序/" class="leancloud_visitors" data-flag-title="归并排序">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h1><hr>
<p>最近学了一个新的排序方法，分享给大家</p>
<h2 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h2><p>利用递归原理，把一个数组逐渐分割成两个很小的单位，然后进行比较，返回比较后的数组，再往上递归回去。<br><strong>比如一个数组a[1,3,2,7,5]</strong><br>1 第一次将数组分为left=[1,3],right=[2,7,5]<br>2 第二次递归将[1,3]分为[1],[3],这是已经是最小单位，然后进行比较1，3<br>创建一个新的数组result[]，将小的压进result，然后将left数组为空，进行下一步，把right的数值压进result，最后返回result<br>3 第三次递归将[2,7,5]分为[2,7],[5]<br>4 第四次递归将[2,7]分为[2],[7],然后重新比较，返回result<br>5 回到上一层，这是比较的是[2,7]和[5],因为2&lt;5，将2压进result，再次比较7和5，jiang 5压进，这个时候right为空，进行下一步，把left剩余数值压进result，返回result=[2，5，7]<br>6 返回上一层，这时候比较的是left=[1,3],right=[2,5,7]，同理最后返回[1,2,3,5,7]，排序成功</p>
<font color="red">不清楚的朋友可以自己按代码一步一步走下去感受一下步骤</font>

<h2 id="下面是我测试的代码"><a href="#下面是我测试的代码" class="headerlink" title="下面是我测试的代码"></a>下面是我测试的代码</h2><pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;sort&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;script&gt;
    window.onload = function(){

        //创建测试用的随机数组
        var textArray = (function(){
            var arr =new Array(10000).join(&quot;,&quot;).split(&quot;,&quot;);
            //如果是arr =new Array(100),虽然长度为100，可是里面没有元素的
            arr=arr.map(function(item){
                return Math.floor(Math.random()*10000);
            })
            return arr;
        })();
        console.log(textArray);
        var durantion1 = text1(textArray);
        var durantion2 = text2(textArray);
        console.log(&quot;归并排序:&quot;+durantion1);
        console.log(&quot;冒泡排序:&quot;+durantion2);

        //归并排序
        function MergeSort (arr){
            if(!(arr instanceof Array)){return;}
            var len = arr.length;
            if(len&lt;2) return arr;
            var middle = Math.floor(len/2),
            left = arr.slice(0,middle),
            right = arr.slice(middle);
            return sort(MergeSort (left),MergeSort (right));
            function sort(left,right){
                var result = [];
                while(left.length&amp;&amp;right.length){
                    if(left[0]&lt;=right[0]){
                        result.push(left.shift());
                    }else{
                        result.push(right.shift());
                    }
                }
                while(left.length){
                    result.push(left.shift());
                }
                while(right.length){
                    result.push(right.shift());
                }
                return result;
            }
        }

        //冒泡排序
        function BubleSort(arr){
            var len = arr.length;
            for(var i=0;i&lt;len;i++){
                for(var j=0;j&lt;len-1-i;j++){
                    if(arr[j]&gt;arr[j+1]){
                        var temp = arr[j+1];
                        arr[j+1] = arr[j];
                        arr[j] = temp;
                    }
                }
            }
            return arr;
        }

        //测试算法时间
        function text1(textArray){
            var start = new Date().getTime();
            MergeSort(textArray);
            var end = new Date().getTime();//接受时间
            return (end - start)+&quot;ms&quot;;//返回函数执行需要时间
        }
        function text2(textArray){
            var start = new Date().getTime();
            BubleSort(textArray);
            var end = new Date().getTime();//接受时间
            return (end - start)+&quot;ms&quot;;//返回函数执行需要时间
        }
    }
&lt;/script&gt;
&lt;/html&gt;
</code></pre><p>  这次测试我用冒泡排序来比较，在比较小的数组下，归并和冒泡几乎没什么差别，测试了下在1000空间下差别是大概7ms之间，到10000空间的时候，归并排序就比冒泡排序快10倍以上</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/17/搭建vue音乐播放器（1）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/17/搭建vue音乐播放器（1）/" itemprop="url">搭建vue音乐播放器（1）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T15:16:23+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/05/17/搭建vue音乐播放器（1）/" class="leancloud_visitors" data-flag-title="搭建vue音乐播放器（1）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="搭建vue音乐播放器（1）"><a href="#搭建vue音乐播放器（1）" class="headerlink" title="搭建vue音乐播放器（1）"></a>搭建vue音乐播放器（1）</h1><hr>
<h2 id="首页轮播组件解析"><a href="#首页轮播组件解析" class="headerlink" title="首页轮播组件解析"></a>首页轮播组件解析</h2><h3 id="实现功能"><a href="#实现功能" class="headerlink" title="实现功能"></a>实现功能</h3><blockquote>
<ul>
<li>自动轮播</li>
<li>滑动切换</li>
<li>点击indicator切换</li>
</ul>
</blockquote>
<h3 id="html："><a href="#html：" class="headerlink" title="html："></a>html：</h3><pre><code>&lt;template&gt;
    &lt;div class=&quot;swiper&quot;&gt;
        &lt;div class=&quot;swiper-items-wrap&quot; ref=&quot;wrap&quot;&gt;
            &lt;slot&gt;&lt;/slot&gt;
        &lt;/div&gt;
        &lt;div class=&quot;swiper-indicators-wrap&quot;&gt;
            &lt;div class=&quot;swiper-indicator&quot; :class=&quot;{&apos;is-active&apos;:$index==index}&quot; v-for=&quot;(page,$index) in pages&quot; v-show=&quot;showIndicators&quot; @click=&quot;nevigateTo($event,$index)&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre><h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p> 假设有4个页面，分别标号为1，2，3，4</p>
<p> <strong>css样式初始化：</strong> 1页面设置为block，其他为none</p>
<p> <strong>页面初始化：</strong> 获取<code>&lt;div class=&quot;swiper-items-wrap&quot; ref=&quot;wrap&quot;&gt;&lt;/div&gt;</code>这个节点,然后获取它下面子节点的个数，根据这个子节点的长度初始化indicator</p>
<p><strong>鼠标按下：</strong> 删除保存的移动方向<font color="red">（不然单击页面会自动移动）</font>，初始化页面位置（调用initPos方法）<br>根据当前的index，将index–，index++设置block，分别设置为前一个页面和后一个页面。这样就存在三个设置为block的页面</p>
<p><strong>鼠标移动：</strong> 保存鼠标移动的方向（toward），保存移动的距离（offset），调用translate方法移动页面</p>
<p><strong>鼠标离开：</strong> </p>
<ol>
<li>判断移动的距离，如果小于页面的一半，则取消移动，重新初始化页面，此时页面依然是1，2，3显示为block</li>
<li>如果距离大于页面一般，则先将当前的3个页面设置为none隐藏，令index++<font color="red">（index–，这个根据方向判断）</font>,再重置页面位置，这时候显示的是2，3，4（block），其他未none，因为2，3页面在移动时候设置了动画，所以即使由block-&gt;none-&gt;block，动画却不会断开。相当于从隐藏的位置到初始化位置的动画过渡。</li>
</ol>
<hr>
<h2 id="bug修复"><a href="#bug修复" class="headerlink" title="bug修复"></a>bug修复</h2><ol>
<li>单个页面时候取消移动效果</li>
<li>两个页面的时候取消动画效果</li>
<li>三个页面时候把位置由前-&gt;后 或者 后-&gt;前变化的页面动画取消<font color="red">也就是说这种算法至少需要4个页面</font>



</li>
</ol>
<p>放上轮播组件的github地址： <a href="https://github.com/yezi12138/swiper" target="_blank" rel="external">https://github.com/yezi12138/swiper</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/16/npm-publish发布插件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yezi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yezi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/16/npm-publish发布插件/" itemprop="url">npm publish发布插件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T00:08:39+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/05/16/npm-publish发布插件/" class="leancloud_visitors" data-flag-title="npm publish发布插件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="通过npm-publish发布自己的插件"><a href="#通过npm-publish发布自己的插件" class="headerlink" title="通过npm publish发布自己的插件"></a>通过npm publish发布自己的插件</h1><hr>
<p>最近做一个项目需要用到轮播效果，于是就想着自己开发一个组件，可以通过npm install安装，这样可以循环利用我开发的组件</p>
<h3 id="这是我的文件目录"><a href="#这是我的文件目录" class="headerlink" title="这是我的文件目录"></a>这是我的文件目录</h3><p><img src="http://a3.qpic.cn/psb?/V11dGOEK4JH7xZ/joJSPWVIJmxRBbz2fnAd9m3IWIW88J0o4qpCVX.tMsI!/b/dG0BAAAAAAAA&amp;bo=wgCZAAAAAAADB3k!&amp;rf=viewer_4" alt="list"></p>
<h3 id="第一步是创建入口文件，这里我举例创建swiper-js文件"><a href="#第一步是创建入口文件，这里我举例创建swiper-js文件" class="headerlink" title="第一步是创建入口文件，这里我举例创建swiper.js文件"></a>第一步是创建入口文件，这里我举例创建swiper.js文件</h3><pre><code>import swiper from &apos;../src/swiper&apos;; //这是我所需要的组件
export default  swiper;   //将组件导出
</code></pre><hr>
<h3 id="在根目录下进入cmd，输入npm-init-生成package-json文件"><a href="#在根目录下进入cmd，输入npm-init-生成package-json文件" class="headerlink" title="在根目录下进入cmd，输入npm init 生成package.json文件"></a>在根目录下进入cmd，输入npm init 生成package.json文件</h3><p>其中 ：<br> name  这是通过npm install的文件名<br> version 这是版本号，每次发布的版本号不能相同<br> description 这是对插件的描述<br> repository 这是github的仓库</p>
<p> 下面是我创建的package文件代码</p>
<pre><code>{
  &quot;name&quot;: &quot;banner-swiper&quot;,
  &quot;version&quot;: &quot;1.0.3&quot;,
  &quot;description&quot;: &quot;simple swiper for vue&quot;,
  &quot;main&quot;: &quot;dist/swiper.js&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },
  &quot;repository&quot;: {
    &quot;type&quot;: &quot;git&quot;,
    &quot;url&quot;: &quot;git+ssh://git@github.com/yezi12138/swiper.git&quot;
  },
  &quot;author&quot;: &quot;yezi12138&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;bugs&quot;: {
    &quot;url&quot;: &quot;https://github.com/yezi12138/swiper/issues&quot;
  },
  &quot;homepage&quot;: &quot;https://github.com/yezi12138/swiper#readme&quot;
}
</code></pre><hr>
<h3 id="接下来就到了发布环节"><a href="#接下来就到了发布环节" class="headerlink" title="接下来就到了发布环节"></a>接下来就到了发布环节</h3><p>首先登陆npm账号（没有就去注册一个）</p>
<blockquote>
<p>npm login</p>
</blockquote>
<p>会提示你输入名字、密码和邮箱</p>
<p>然后发布</p>
<blockquote>
<p>npm publish</p>
</blockquote>
<p>如果发布出错，错误是you don’t have permission…可能是你的name已经被创建了，换个名字再试试</p>
<p>贴上我插件的github地址：<a href="https://github.com/yezi12138/swiper" target="_blank" rel="external">https://github.com/yezi12138/swiper</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="yezi" />
          <p class="site-author-name" itemprop="name">yezi</p>
           
              <p class="site-description motion-element" itemprop="description">personal develop</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yezi</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>
<div>
  <span id="busuanzi_container_site_uv">
  total visited  <span id="busuanzi_value_site_uv" class="theme-link"></span>  times
</span>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("rDSYKuVWnEhpcTVUFtDO19kY-gzGzoHsz", "xUOAx49gXbPVpMgp3dtpl9La");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
