---
title: 客户端检测
date: 2017-06-08 17:37:44
tags: -js
---
# 客户端检测手段

------

检测手段是通过检测用户代理字符串来判断相应的客户端。

> * 首先检测opera,opera有专属的属性window.opera.version
> * 然后检测webkit内核的浏览器，检测唯一字符串AppleWebKit,如果在这基础上有chrome字符，则是chrome浏览器，否则是safari
> * 接着检测引擎是khtml，即konq浏览器
> * 最后检测ie，唯一字符串是MSIE


## chrome代理字符串
#### Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36

## firefox代理字符串
#### Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0

## opera代理字符串（最新移除了window.opera属性，所以要对最新的opera要判断字符串OPR）
#### Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 OPR/45.0.2552.888

## IE（11版本一下）代理字符串
#### Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)

## IE11代理字符串
#### Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko

## edge代理字符串
#### Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36 Edge/14.14393

---

代码如下：

    <script>
		window.onload = function(){
			var client = (function(){
				var engine = {
				//呈现引擎
				ie:0,
				gecko:0,
				webkit:0,
				khtml:0,
				opera:0,
				ver:null
			}

			var browser = {
				ie:0,
				firefox:0,
				safari:0,
				konq:0,
				opera:0,
				chrome:0,
				ver:null,
				edge:0
			}
			return {
				engine:engine,
				browser:browser
			};
		})()
		var engine = client.engine;
		var browser = client.browser;
		var ua = navigator.userAgent;
		console.log(ua);
		if(window.opera){  /*最新版opera移除了这个属性 Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 OPR/45.0.2552.888*/
			engine.ver = window.opera.version();
			engine.opera = browser.opera = parseFloat(engine.ver)
		}else if(/OPR\/(\S+)/.test(ua)){
			engine.ver = RegExp["$1"];
			engine.opera = browser.opera = parseFloat(engine.ver)
		}else if(/AppleWebKit\/(\S+)/.test(ua)){
			engine.ver = RegExp["$1"];
			engine.webkit = parseFloat(engine.ver)
			//确定是chrome还是safari还是edge
			if(/Edge\/(\S+)/.test(ua)){
				browser.ver = RegExp["$1"];
				browser.edge = parseFloat(browser.ver);
			}else if(/Chrome\/(\S+)/.test(ua)){
				browser.ver = RegExp["$1"];
				browser.chrome = parseFloat(browser.ver);
			}else if(/Version\/(\S+)/.test(ua)){
				browser.ver = RegExp["$1"];
				browser.safari = parseFloat(browser.ver);
			}else{
				var safariVersion = 1;
				if(engine.webkit<100){
					safariVersion = 1;
				}else if(engine.webkit<312){
					safariVersion = 1.2;
				}else if(engine.webkit<412){
					safariVersion = 1.3;
				}else {
					safariVersion = 2;
				}

				browser.safari = browser.ver = safariVersion;
			}
		}else if(/KHTML\/(\S+)/.test(ua)||/Konqueror\/([^;]+)/.test(ua)){
			engine.ver = RegExp["$1"];
			engine.khlmt =  browser.konq = parseFloat(engine.ver)
		}else if(/rv:([^\)]+)\) Gecko\/\d{8}/.test(ua)){
	engine.ver = RegExp["$1"];
	engine.gecko = parseFloat(engine.ver)
			//确定是不是firefox
			if(/Firefox\/(\S+)/.test(ua)){
				browser.ver = RegExp["$1"];
				browser.firefox = parseFloat(browser.ver);
			}
		}else if(/MSIE ([^;]+)/.test(ua)){
			engine.ver = RegExp["$1"];
			engine.ie =  browser.ie  = parseFloat(engine.ver)
		}else if(/Trident\/([^;]+)/.test(ua)){
			engine.ver = 11.0;
			engine.ie =  browser.ie  = parseFloat(engine.ver)
		}
		console.log(engine);
		console.log(browser)
	}
    </script>
    
    
---

上面是我个人测试常用电脑浏览器的手段，如果要更加详细的检查手段，可以查阅下面的网址
github上的客户端检查测代码（https://github.com/hotoo/detector）